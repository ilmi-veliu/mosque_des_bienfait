"use client";"use strict";var K=Object.defineProperty,T=Object.defineProperties;var b=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var w=(e,t,n)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,S=(e,t)=>{for(var n in t||(t={}))q.call(t,n)&&w(e,n,t[n]);if(F)for(var n of F(t))B.call(t,n)&&w(e,n,t[n]);return e},D=(e,t)=>T(e,b(t));var E=(e,t)=>{var n={};for(var s in e)q.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&F)for(var s of F(e))t.indexOf(s)<0&&B.call(e,s)&&(n[s]=e[s]);return n};Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const f=require("react/jsx-runtime"),c=require("react"),k=require("talkjs"),U=c.createContext(void 0);function A(){const e=c.useContext(U);return e!=null&&e.isAlive?e:void 0}function L(){const e=A(),[t,n]=c.useState();return c.useEffect(()=>{if(!e||!e.isAlive){n(void 0);return}const s=e.unreads.onChange(o=>{n(o)});return()=>s.unsubscribe()},[e]),t}function C({target:e,handlers:t}){return e!=null&&e.isAlive?Object.keys(t).filter(s=>s.startsWith("on")).filter(s=>typeof t[s]=="function").map(s=>f.jsx(_,{name:s,handler:t[s],target:e},s)):null}function _(e){const{handler:t}=e;return c.useEffect(()=>{var r,i;if(!((r=e.target)!=null&&r.isAlive))return;const{name:n,target:s}=e.name==="onUnreadsChange"?{name:"onChange",target:e.target.unreads}:{name:e.name,target:e.target};if(typeof s[n]!="function"){console.warn(`[@talkjs/react] Trying to handle event ${n} which does not exist on ${(i=s==null?void 0:s.constructor)==null?void 0:i.name}. Did you make a typo?`);return}const o=s[n](t);return()=>{o.unsubscribe()}},[e.target,e.name,t]),null}function $(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var z=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var s,o,r;if(Array.isArray(t)){if(s=t.length,s!=n.length)return!1;for(o=s;o--!==0;)if(!e(t[o],n[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(r=Object.keys(t),s=r.length,s!==Object.keys(n).length)return!1;for(o=s;o--!==0;)if(!Object.prototype.hasOwnProperty.call(n,r[o]))return!1;for(o=s;o--!==0;){var i=r[o];if(!e(t[i],n[i]))return!1}return!0}return t!==t&&n!==n};const J=$(z);function M(e){const t=c.useRef();return(!t.current||!J(e,t.current.val))&&(t.current={val:e}),t.current.val}function d(e,t,n){t=M(t),c.useEffect(()=>{t!==void 0&&(e!=null&&e.isAlive)&&e[n](t)},[n,e,t])}function Q(e,t,n){t=M(t),c.useEffect(()=>{t!==void 0&&(e!=null&&e.isAlive)&&e[n](...t)},[n,e,t])}function P(e,t,n,s,o){const r=c.useMemo(()=>typeof n=="function"?e!=null&&e.isAlive?n(e):void 0:n!=null?n:s,[e,n,s]);Q(t,r!==void 0?[r,{asGuest:o}]:void 0,"select")}function I(e,t,n,s){const[o,r]=c.useState();return n=M(n),c.useEffect(()=>{if(e!=null&&e.isAlive){const i=e[t](n);return r(i),s&&(s.current=i),()=>{i.destroy(),r(void 0)}}else r(void 0),s&&(s.current=void 0)},[e,t,n]),o}function G(e,t){const[n,s]=c.useState(!1);return c.useEffect(()=>{e!=null&&e.isAlive&&e.mount(t).then(()=>s(!0))},[e]),n}function V(e){const[t,n]=c.useState(!1),[s,o]=c.useState(),{userId:r,syncUser:i,appId:v,token:y,tokenFetcher:m,signature:g,sessionRef:a,desktopNotificationEnabled:j}=e;return c.useEffect(()=>{k.ready.then(()=>n(!0))},[]),c.useEffect(()=>{if(t){const p=typeof i=="function"?i():i!=null?i:new k.User(r),u=new k.Session({appId:v,me:p,token:y,tokenFetcher:m,signature:g});return o(u),a&&(a.current=u),()=>{u.destroy(),o(void 0),a&&(a.current=void 0)}}},[t,g,v,r,i,a]),d(s,j,"setDesktopNotificationEnabled"),f.jsxs(f.Fragment,{children:[f.jsx(U.Provider,{value:s,children:e.children}),f.jsx(C,{target:s,handlers:e})]})}const N=(()=>{const e=new WeakMap;let t=0;return function(s){return e.has(s)||e.set(s,++t),e.get(s)}})();function R(e,t){const n={},s={};for(const[o,r]of Object.entries(e))o.startsWith(t)?n[o]=r:s[o]=r;return[n,s]}function H(e){const{box:t,loadingComponent:n,className:s,handlers:o}=e,r=c.useRef(null),i=G(t,r.current),v=i?e.style:D(S({},e.style),{display:"none"});return f.jsxs(f.Fragment,{children:[!i&&f.jsx("div",{style:e.style,className:s,children:n}),f.jsx("div",{ref:r,style:v,className:s}),f.jsx(C,{target:t,handlers:o})]})}function X(e){const t=A();if(t){const n=N(t);return f.jsx(Y,S({session:t},e),n)}else return f.jsx("div",{style:e.style,className:e.className,children:e.loadingComponent})}function Y(e){const l=e,{session:t,conversationId:n,syncConversation:s,asGuest:o,chatboxRef:r,style:i,className:v,loadingComponent:y}=l,m=E(l,["session","conversationId","syncConversation","asGuest","chatboxRef","style","className","loadingComponent"]),[g,a]=R(m,"on"),x=a,{messageFilter:j,presence:p,highlightedWords:u}=x,O=E(x,["messageFilter","presence","highlightedWords"]),h=I(t,"createChatbox",O,r);return d(h,j,"setMessageFilter"),d(h,p,"setPresence"),d(h,u,"setHighlightedWords"),P(t,h,s,n,o),f.jsx(H,{box:h,session:t,className:v,style:i,loadingComponent:y,handlers:g})}function Z(e){const t=A();if(t){const n=N(t);return f.jsx(ee,S({session:t},e),n)}else return f.jsx("div",{style:e.style,className:e.className,children:e.loadingComponent})}function ee(e){const x=e,{session:t,conversationId:n,syncConversation:s,asGuest:o,inboxRef:r,style:i,className:v,loadingComponent:y}=x,m=E(x,["session","conversationId","syncConversation","asGuest","inboxRef","style","className","loadingComponent"]),[g,a]=R(m,"on"),W=a,{messageFilter:j,feedFilter:p,presence:u,highlightedWords:O}=W,h=E(W,["messageFilter","feedFilter","presence","highlightedWords"]),l=I(t,"createInbox",h,r);return d(l,j,"setMessageFilter"),d(l,p,"setFeedFilter"),d(l,u,"setPresence"),d(l,O,"setHighlightedWords"),P(t,l,s,n,o),f.jsx(H,{box:l,session:t,className:v,style:i,loadingComponent:y,handlers:g})}function te(e){const t=A();if(t){const n=N(t);return f.jsx(ne,S({session:t},e),n)}return null}function ne(e){const h=e,{session:t,conversationId:n,syncConversation:s,asGuest:o,show:r,popupRef:i}=h,v=E(h,["session","conversationId","syncConversation","asGuest","show","popupRef"]),[y,m]=R(v,"on"),l=m,{messageFilter:g,presence:a,highlightedWords:j}=l,p=E(l,["messageFilter","presence","highlightedWords"]),u=I(t,"createPopup",p,i);d(u,g,"setMessageFilter"),d(u,a,"setPresence"),d(u,j,"setHighlightedWords"),P(t,u,s,n,o);const O=G(u,{show:r!=null?r:!0});return c.useEffect(()=>{r===void 0||!O||(r?u==null||u.show():u==null||u.hide())},[r,O,u]),f.jsx(C,{target:u,handlers:y})}exports.Chatbox=X;exports.Inbox=Z;exports.Popup=te;exports.Session=V;exports.useSession=A;exports.useUnreads=L;
